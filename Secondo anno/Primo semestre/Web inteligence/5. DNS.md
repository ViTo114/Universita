# INTRODUZIONE AL DNS - IL TRADUTTORE DI INTERNET
Il Domain Name Service (DNS) è uno dei pilastri fondamentali su cui si regge l'intera architettura di Internet. La sua funzione può essere paragonata a quella di una gigantesca "rubrica telefonica" globale, progettata per rendere la navigazione web e l'uso delle risorse di rete un'esperienza intuitiva per gli esseri umani. Senza il DNS, per accedere a un qualsiasi sito web, saremmo costretti a memorizzare e digitare lunghe e complesse sequenze di numeri, note come indirizzi IP, un compito impraticabile e contrario alla natura logica con cui pensiamo e interagiamo.

La funzione primaria del DNS è, quindi, quella di produrre una corrispondenza tra i nomi logici, facilmente memorizzabili (come `www.google.it`), e gli indirizzi IP numerici che i computer utilizzano per identificarsi e comunicare tra loro sulla rete. Questo processo di traduzione, o risoluzione, è costante e trasparente per l'utente finale. Ad esempio:

• Il nome logico `sisinflab.poliba.it` viene tradotto nell'indirizzo IP `193.204.49.75`.

• Il nome logico `www.google.it` corrisponde all'indirizzo IP `66.233.183.104`.

Oltre a questa funzione principale, il DNS svolge un ruolo secondario ma altrettanto importante come "alias di posta". Quando si invia un'email, ad esempio a un indirizzo come `m.ruta@poliba.it`, il sistema DNS viene interrogato tramite una query specifica (di tipo MX) per individuare l'indirizzo IP o l'hostname del Mail Server responsabile della gestione della posta per il dominio `poliba.it`, garantendo così il corretto instradamento del messaggio.

Per realizzare questi compiti, il sistema DNS si basa su tre componenti fondamentali:

• **Schema di denominazione gerarchico:** Un sistema di nomenclatura strutturato ad albero, basato sul concetto di dominio (es. `.it`, `.com`, `poliba.it`).

• **Database distribuito:** Un immenso database che non risiede su un unico server, ma è frammentato e distribuito su innumerevoli server in tutto il mondo, ognuno responsabile di una porzione dello schema di denominazione.

• **Protocollo:** Un insieme di regole e formati di messaggi che permettono ai vari server DNS di comunicare tra loro per mantenere, distribuire e recuperare le informazioni di corrispondenza.

Questa complessa architettura è organizzata in modo gerarchico per garantire l'efficienza, la scalabilità e la resilienza necessarie a sostenere l'intera rete Internet.






# L'ARCHITETTURA GERARCHICA E DISTRIBUITA DEL DNS
È facile intuire come sarebbe impossibile per una singola entità, o un unico server, gestire l'intera rubrica di Internet. Il volume di richieste, la necessità di aggiornamenti costanti e il rischio di un singolo punto di fallimento renderebbero un sistema centralizzato del tutto inadeguato. Per questo motivo, il DNS è stato progettato con una struttura strategica, gerarchica e distribuita, che ne garantisce la gestione, la scalabilità e la resilienza.

Il cuore di questa architettura è il concetto di **"zona"**, che rappresenta un nodo specifico nell'albero gerarchico del DNS. La responsabilità della gestione di queste zone viene delegata dal NIC (Network Information Center) a singole organizzazioni, che diventano così autonome nell'amministrazione del proprio "spazio dei nomi". Ad esempio, l'organizzazione che gestisce il dominio `poliba.it` è responsabile della zona corrispondente.

All'interno di ogni zona, operano dei server con ruoli ben definiti, cruciali per il funzionamento del sistema:

• **Server primario:** È il server "autoritativo" per quella specifica zona. Ciò significa che gestisce direttamente il database delle corrispondenze nome-IP per il suo dominio di competenza e garantisce una conversione corretta e affidabile. Le sue informazioni sono considerate la fonte originale della verità.

• **Server secondario:** Agisce come una copia di backup del server primario, garantendo ridondanza e bilanciamento del carico. Mantiene una copia delle corrispondenze della zona e si aggiorna dinamicamente interrogando periodicamente il server primario per assicurare un perfetto allineamento dei dati.

Al vertice di questa imponente gerarchia si trovano i cosiddetti **"root name server"**. Questi server sono responsabili della gestione del nodo radice (indicato con un "."), il punto più alto dell'intero albero DNS, e conoscono gli indirizzi dei server che gestiscono i domini di primo livello (come `.it`, `.com`, `.org`).

Per permettere a tutti questi server, distribuiti globalmente e gestiti da diverse organizzazioni, di comunicare in modo efficace, è necessario un formato di messaggio standardizzato.




# LI FORMATO DEI MESSAGGI E I RESOURCE RECORD (RR)
Data la natura distribuita del DNS, l'importanza di un formato di messaggio ben definito e universalmente compreso è assoluta. Le informazioni scambiate tra i server possono essere di varia natura: una richiesta (query), una risposta, informazioni autorevoli o dati supplementari. Per gestire questa variabilità, ogni messaggio DNS è strutturato con un'intestazione (header) a formato fisso, che contiene le proprietà generali del pacchetto, e diverse sezioni a contenuto e lunghezza variabile.

La struttura dati fondamentale che contiene una risposta DNS è il **"Resource Record" (RR)**. Un messaggio DNS può contenere più RR, organizzati in sezioni specifiche a seconda del loro scopo. Le sezioni a lunghezza variabile che compongono il corpo del messaggio sono:

• **Query:** Contiene la domanda posta al server DNS (es. "qual è l'IP di `sisinflab.poliba.it`?").

• **Reply (Risposta):** Contiene i Resource Record con le risposte convenzionali alla query.

• **Absolute (Autoritativo):** Contiene i Resource Record forniti da un server che ha l'autorità diretta sulla zona interrogata.

• **Additional information (Informazioni aggiuntive):** Contiene RR con dati supplementari che possono essere utili per il client per completare la sua richiesta senza dover effettuare ulteriori interrogazioni.

Per garantire che ogni richiesta possa essere associata in modo univoco alla sua risposta, specialmente in un ambiente con migliaia di comunicazioni concorrenti, ogni messaggio DNS contiene un **identificatore intero univoco**. Questo valore, noto come "Transaction ID", viene generato dal client al momento della richiesta e replicato dal server nella risposta, permettendo al client di abbinare correttamente la risposta alla domanda originaria.

Ora che abbiamo visto la struttura generale del messaggio, è utile analizzare in dettaglio i campi dell'intestazione, in particolare i "flag" che ne controllano il comportamento.





# ANALISI DEI FLAG NELL'INTESTAZIONE DNS
L'intestazione di un messaggio DNS non si limita a contenere l'ID di transazione, ma include anche una serie di **"flag"**. Questi sono bit singoli che funzionano come interruttori, permettendo di specificare le proprietà del pacchetto e il tipo di interazione richiesta dal client o fornita dal server. Ogni flag controlla un aspetto specifico della comunicazione DNS.

La tabella seguente analizza in dettaglio i flag più importanti e il loro significato.

| Flag | Significato e Valori Possibili |
| :--- | :--- |
| **QR** (Query/Response) | Indica se il messaggio è una richiesta o una risposta. <br> **0:** query, **1:** response. |
| **Opcode** (Operational code) | Specifica il tipo di query. <br> **0:** standard, **1:** inversa, **2:** stato server, **4:** notify, **5:** update. |
| **AA** (Authoritative Answer) | Indica se la risposta proviene da un server autoritativo. <br> **1:** autoritativa, **0:** non autoritativa. |
| **TC** (Truncated) | Segnala se il messaggio è stato troncato (supera i 512 byte in UDP). <br> **1:** troncato, **0:** integro. |
| **RD** (Recursion Desired) | Richiesta di risoluzione ricorsiva (impostato dal client). <br> **1:** ricorsione desiderata, **0:** iterativa. |
| **RA** (Recursion Available) | Disponibilità alla ricorsione (impostato dal server). <br> **1:** supportata, **0:** non supportata. |
| **Z** (Padding) | Campo riservato per usi futuri. <br> Deve essere sempre **0**. |
| **AD** (Authenticated Data) | Dati autenticati secondo policy DNSSEC. <br> **1:** dati autenticati. |
| **CD** (Checking Disabled) | Disabilita il controllo di validazione sui dati (DNSSEC). <br> **1:** controllo disabilitato. |
| **Rcode** (Return code) | Codice di stato della risposta. <br> **0:** No error, **1:** Format error, **2:** ServFail, **3:** NXDomain, **4:** NotImpl, **5:** Refused, **6-10:** Altri errori specifici. |

Esempio Pratico: `Flags: 0x8180`

Per capire come questi flag vengono interpretati, analizziamo il valore esadecimale `0x8180`. In formato binario, questo valore corrisponde a `1000 0001 1000 0000`. Procedendo con un'analisi bit per bit, possiamo dedurre quanto segue:

• `1... .... .... ....`: Il primo bit (QR) è `1`, quindi **il messaggio è una risposta**.

• `.000 0... .... ....`: I quattro bit di Opcode sono `0000`, indicando una **query standard**.

• `.... .0.. .... ....`: Il bit AA è `0`, per cui il server che ha risposto **non è un'autorità** per il dominio richiesto.

• `.... ..0. .... ....`: Il bit TC è `0`, quindi il messaggio **non è troncato**.

• `.... ...1 .... ....`: Il bit RD è `1`, a significare che nella richiesta originale **era desiderata la ricorsione**.

• `.... .... 1... ....`: Il bit RA è `1`, indicando che **il server può effettuare query ricorsive**.

• `.... .... ..0. ....`: Il bit AD è `0`, per cui la risposta **non è stata autenticata**.

• I quattro bit finali di Rcode sono `0000`, che corrisponde a uno stato di **nessun errore**.

Dopo aver esaminato la teoria del protocollo, passiamo ora a una delle sue implementazioni software più importanti e diffuse.




# BIND, IL CUORE DEI SERVER DNS
L'implementazione software per server DNS più utilizzata al mondo è **BIND (Berkeley Internet Name Domain server)**. Si tratta di un software open-source robusto e affidabile che costituisce la spina dorsale di gran parte dell'infrastruttura DNS globale. Il processo che gira in background su un server per gestire le richieste DNS è noto come demone, e nel caso di BIND, questo demone si chiama `named`.

Un server BIND può essere configurato per operare in diverse modalità, ma due sono le configurazioni tipiche più comuni:

• **Nameserver solo autoritativo (Authoritative-only):** In questa configurazione, il server risponde esclusivamente per i domini di cui ha la gestione diretta, ovvero per le zone per cui "è autoritativo". Se riceve una richiesta per un dominio che non gestisce, non tenterà di risolverla ma indirizzerà il client verso altri server.

• **Server DNS di caching (DNS caching server):** Questo tipo di server non è autoritativo per nessuna zona specifica. Il suo scopo è risolvere tutti gli indirizzi che gli vengono richiesti dai client. Quando riceve una query, la inoltra ad altri server DNS per ottenere la risposta, dopodiché memorizza (mette in cache) tale risposta per un certo periodo di tempo. In questo modo, se riceve nuovamente la stessa richiesta, può rispondere immediatamente usando i dati in cache, accelerando notevolmente il processo. Questa configurazione può essere installata anche su un computer personale per velocizzare le richieste DNS locali.

Vediamo ora come si presenta concretamente un file di configurazione per un server di questo tipo.





# ESEMPIO DI CONFIGURAZIONE DI UN SERVER BIND
La configurazione di un server BIND si basa interamente su file di testo che definiscono il suo comportamento generale e le zone DNS che deve gestire. Analizzare la struttura di questi file permette di rendere concreti i concetti teorici visti finora.

Il file di configurazione principale è solitamente `/etc/named.conf`. Al suo interno si definiscono le opzioni globali e le zone. Un esempio di base include:

• **Blocco** **options**: Questo blocco definisce le opzioni globali del server. Nell'esempio, specifica la directory di lavoro (`/var/named`), ovvero il percorso dove `named` cercherà gli altri file di configurazione delle zone.

• **Blocco** **zone "."**: Questa è la dichiarazione per la zona radice (root). Il `type hint` indica al server che non è autoritativo per questa zona, ma deve caricare gli indirizzi IP dei root name server da un file specifico, in questo caso `root.hints`.

• **Blocco** **zone "0.0.127.in-addr.arpa"**: Questa è una zona speciale utilizzata per la risoluzione inversa (da IP a nome) dell'indirizzo di loopback (`127.0.0.1`). La direttiva `type master` indica che il nostro server è primario (autoritativo) per questa zona e che le informazioni sono contenute nel file `pz/127.0.0`. Questa direttiva `file` punta al file di zona che analizzeremo di seguito, il quale contiene i Resource Record specifici per questa zona di ricerca inversa.

Il file di una zona, come `pz/127.0.0`, contiene invece i Resource Record specifici per quel dominio. Di seguito sono analizzati i record presenti nell'esempio:

• **SOA (Start of Authority):** È il primo record di ogni file di zona e ne descrive le proprietà. Indica il name server primario (`ns.linux.bogus.`), il contatto email dell'amministratore (`hostmaster.linux.bogus.`) e una serie di parametri di temporizzazione:

    ◦ `Serial`: Un numero di versione che deve essere incrementato a ogni modifica del file.

    ◦ `Refresh`: L'intervallo con cui i server secondari devono verificare se ci sono aggiornamenti.

    ◦ `Retry`: L'intervallo di attesa prima di un nuovo tentativo se un server secondario non riesce a contattare il primario.

    ◦ `Expire`: Il periodo dopo il quale i dati della zona su un server secondario scadono se non riesce a contattare il primario.

    ◦ `Minimum TTL`: Il Time To Live di default per i record della zona.

• **NS (Name Server):** Questo record indica quale server è autoritativo per il dominio in questione. In questo caso, è `ns.linux.bogus.`.

• **PTR (Pointer Record):** Questo tipo di record è usato per la risoluzione inversa. In questo esempio, associa il finale dell'IP `.1` (che completa l'indirizzo `127.0.0.1`) al nome host `localhost`.

Dopo aver visto come si configura un server, esploriamo ora uno strumento pratico per interrogare e scoprire informazioni pubbliche relative a un dominio reale.




# INDAGARE I DOMINI E IL COMANDO WHOIS
Uno strumento di utilità fondamentale per ottenere informazioni di registrazione su un nome di dominio è il comando `whois`. Eseguendo questo comando da una shell, è possibile interrogare un database pubblico per scoprire chi è il proprietario di un dominio, chi ne gestisce gli aspetti tecnici e amministrativi e, soprattutto, quali name server sono autoritativi per quel dominio.

Utilizzando le informazioni fornite per il dominio `poliba.it`, possiamo ottenere una sintesi chiara e organizzata dei dati di registrazione:

**Contatto Amministrativo:**

• **Nome:** Valentino Gratton

• **Indirizzo:** Direzione Generale – Struttura ICT – Rete Dati Fonia, via Giovanni Amendola 126/b, 70126 Bari (BA), IT

• **Creato:** 1999-02-11 00:00:00

• **Ultimo Aggiornamento:** 2013-12-05 15:18:39

**Contatti Tecnici:**

• **Nome:** Luigi Gatto

• **Indirizzo:** CECAP - Politecnico di Bari, via Orabona, 4, 70125 Bari (BA), IT

• **Creato:** 1999-02-11 00:00:00

• **Ultimo Aggiornamento:** 2011-03-24 11:01:09

**Registrar:**

• **Organizzazione:** Consortium GARR

• **Nome:** GARR-REG

**Nameserver:**

• cstar.poliba.it

• ns1.garr.net

Partendo dal concetto base di "traduzione" di un nome in un numero, abbiamo esplorato l'architettura gerarchica e distribuita del DNS, analizzato i protocolli di comunicazione con i loro messaggi e flag specifici, e infine esaminato esempi di configurazione e strumenti pratici per l'interrogazione. Questo percorso offre una visione completa del funzionamento del Domain Name Service, un sistema tanto complesso quanto indispensabile per l'Internet moderno.